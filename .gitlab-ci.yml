variables:
    GIT_SUBMODULE_STRATEGY: recursive

stages:
    - build
    - tests
    - deploy



build-rel:
    stage: build
    before_script:
        - ./prebuild.sh
    script:
        - make release
    tags:
        - rpi-biurko
    artifacts:
        name: OBJ_$COMMIT_TIME
        expire_in: 1 week
        paths:
            - Logs
            - build
            - inc


build-dbg:
    stage: build
    before_script:
        - ./prebuild.sh
    script:
        - make debug
    tags:
        - rpi-biurko
    artifacts:
        name: OBJ_$COMMIT_TIME
        expire_in: 1 week
        paths:
            - Logs
            - build
            - inc



tests-json:
    stage: tests
    script:
        - ./build/rel/BFutils_tests json
    tags:
        - rpi-biurko
    artifacts:
        name: OBJ_$COMMIT_TIME
        expire_in: 1 week
        paths:
            - Logs



tests-stream:
    stage: tests
    script:
        - ./build/rel/BFutils_tests stream
    tags:
        - rpi-biurko
    artifacts:
        name: OBJ_$COMMIT_TIME
        expire_in: 1 week
        paths:
            - Logs



tests-logging:
    stage: tests
    script:
        - ./build/rel/BFutils_tests logging
    tags:
        - rpi-biurko
    artifacts:
        name: OBJ_$COMMIT_TIME
        expire_in: 1 week
        paths:
            - Logs



tests-udp:
    stage: tests
    script:
        - ./build/rel/BFutils_tests udp
    tags:
        - rpi-biurko
    artifacts:
        name: OBJ_$COMMIT_TIME
        expire_in: 1 week
        paths:
            - Logs



tests-event:
    stage: tests
    script:
        - ./build/rel/BFutils_tests event
    tags:
        - rpi-biurko
    artifacts:
        name: OBJ_$COMMIT_TIME
        expire_in: 1 week
        paths:
            - Logs



deploy:
    stage: deploy
    script:
        - ./package.sh $CI_COMMIT_BRANCH
    only:
        - stable
        - test
    tags:
        - rpi-biurko
    artifacts:
        name: OBJ_$COMMIT_TIME
        expire_in: 1 week
        paths:
            - deb


